<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—É—Ä—Ç–æ–∂–∏—Ç–∫–æ–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border-color: #667eea;
        }

        .menu-card h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-card p {
            color: #666;
            line-height: 1.5;
        }

        .icon {
            font-size: 1.5rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .no-data {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üè† –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—É—Ä—Ç–æ–∂–∏—Ç–∫–æ–º</h1>
    </div>

    <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
            <div class="stat-number" id="totalStudents">0</div>
            <div class="stat-label">–í—Å—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalSettlements">0</div>
            <div class="stat-label">–ü–æ—Å–µ–ª–µ–Ω—å</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalPayments">0</div>
            <div class="stat-label">–û–ø–ª–∞—Ç</div>
        </div>
    </div>

    <div class="menu-grid">
        <div class="menu-card" onclick="openModal('addStudentModal')">
            <h3><span class="icon">üë§</span>–î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
            <p>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º—ñ –≥—É—Ä—Ç–æ–∂–∏—Ç–∫—É</p>
        </div>

        <div class="menu-card" onclick="viewStudents()">
            <h3><span class="icon">üìã</span>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h3>
            <p>–ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø–∏—Å–∫—É –≤—Å—ñ—Ö –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</p>
        </div>

        <div class="menu-card" onclick="openModal('settleStudentModal')">
            <h3><span class="icon">üè†</span>–ü–æ—Å–µ–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
            <p>–ü–æ—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ –∫—ñ–º–Ω–∞—Ç—É –≥—É—Ä—Ç–æ–∂–∏—Ç–∫—É</p>
        </div>

        <div class="menu-card" onclick="openModal('addPaymentModal')">
            <h3><span class="icon">üí∞</span>–î–æ–¥–∞—Ç–∏ –æ–ø–ª–∞—Ç—É</h3>
            <p>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –æ–ø–ª–∞—Ç–∏ –∑–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è</p>
        </div>

        <div class="menu-card" onclick="openModal('viewPaymentsModal')">
            <h3><span class="icon">üìä</span>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –æ–ø–ª–∞—Ç–∏</h3>
            <p>–ü–µ—Ä–µ–≥–ª—è–¥ —ñ—Å—Ç–æ—Ä—ñ—ó –æ–ø–ª–∞—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞</p>
        </div>

        <div class="menu-card" onclick="viewSettlements()">
            <h3><span class="icon">üèòÔ∏è</span>–°–ø–∏—Å–æ–∫ –ø–æ—Å–µ–ª–µ–Ω—å</h3>
            <p>–ü–µ—Ä–µ–≥–ª—è–¥ –≤—Å—ñ—Ö –ø–æ—Ç–æ—á–Ω–∏—Ö –ø–æ—Å–µ–ª–µ–Ω—å</p>
        </div>

        <div class="menu-card" onclick="openModal('deleteStudentModal')">
            <h3><span class="icon">‚ùå</span>–í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
            <p>–ü–æ–≤–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑ —Å–∏—Å—Ç–µ–º–∏</p>
        </div>

        <div class="menu-card" onclick="openModal('evictStudentModal')">
            <h3><span class="icon">üö™</span>–í–∏—Å–µ–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
            <p>–í–∏—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑ –∫—ñ–º–Ω–∞—Ç–∏</p>
        </div>
    </div>
</div>

<!-- Modal –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
<div id="addStudentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addStudentModal')">&times;</span>
        <h2>–î–æ–¥–∞–≤–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
        <form id="addStudentForm">
            <div class="form-group">
                <label for="studentName">–ü–Ü–ë:</label>
                <input type="text" id="studentName" required>
            </div>
            <div class="form-group">
                <label for="birthDate">–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è:</label>
                <input type="date" id="birthDate" required>
            </div>
            <div class="form-group">
                <label for="gender">–°—Ç–∞—Ç—å:</label>
                <select id="gender" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—å</option>
                    <option value="male">–ß–æ–ª–æ–≤—ñ—á–∞</option>
                    <option value="female">–ñ—ñ–Ω–æ—á–∞</option>
                </select>
            </div>
            <div class="form-group">
                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
                <label for="group">–ì—Ä—É–ø–∞:</label>
                <input type="text" id="group" required>
            </div>
            <div class="form-group">
                <label for="passport">–ü–∞—Å–ø–æ—Ä—Ç:</label>
                <input type="text" id="passport" required>
            </div>
            <button type="submit" class="btn" id="addStudentBtn">–î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('addStudentModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </form>
    </div>
</div>

<!-- Modal –ø–µ—Ä–µ–≥–ª—è–¥ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ -->
<div id="viewStudentsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('viewStudentsModal')">&times;</span>
        <h2>–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h2>
        <div class="search-box">
            <input type="text" id="studentSearch" placeholder="–ü–æ—à—É–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤..." onkeyup="filterStudents()">
        </div>
        <div class="loading" id="studentsLoading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        <div id="studentsTableContainer"></div>
    </div>
</div>

<!-- Modal –∑–∞—Å–µ–ª–µ–Ω–Ω—è -->
<div id="settleStudentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('settleStudentModal')">&times;</span>
        <h2>–ü–æ—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
        <form id="settleStudentForm">
            <div class="form-group">
                <label for="settleStudentId">–°—Ç—É–¥–µ–Ω—Ç:</label>
                <select id="settleStudentId" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
                </select>
            </div>
            <div class="form-group">
                <label for="roomNumber">–ù–æ–º–µ—Ä –∫—ñ–º–Ω–∞—Ç–∏:</label>
                <select id="roomNumber" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É</option>
                </select>
            </div>
            <div class="form-group">
                <label for="settleDate">–î–∞—Ç–∞ –ø–æ—Å–µ–ª–µ–Ω–Ω—è:</label>
                <input type="date" id="settleDate" required>
            </div>
            <button type="submit" class="btn" id="settleStudentBtn">–ü–æ—Å–µ–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('settleStudentModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </form>
    </div>
</div>

<!-- Modal –¥–æ–¥–∞—Ç–∏ –ø–ª–∞—Ç–µ–∂ -->
<div id="addPaymentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addPaymentModal')">&times;</span>
        <h2>–î–æ–¥–∞–≤–∞–Ω–Ω—è –æ–ø–ª–∞—Ç–∏</h2>
        <form id="addPaymentForm">
            <div class="form-group">
                <label for="paymentStudentId">–°—Ç—É–¥–µ–Ω—Ç:</label>
                <select id="paymentStudentId" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
                </select>
            </div>
            <div class="form-group">
                <label for="paymentDate">–î–∞—Ç–∞ –æ–ø–ª–∞—Ç–∏:</label>
                <input type="date" id="paymentDate" required>
            </div>
            <div class="form-group">
                <label for="amount">–°—É–º–∞ (–≥—Ä–Ω):</label>
                <input type="number" id="amount" step="0.01" required min="0">
            </div>
            <div class="form-group">
                <label for="paymentMethod">–°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:</label>
                <select id="paymentMethod" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–±</option>
                    <option value="cash">–ì–æ—Ç—ñ–≤–∫–∞</option>
                    <option value="card">–ö–∞—Ä—Ç–∫–∞</option>
                    <option value="bank_transfer">–ë–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π –ø–µ—Ä–µ–∫–∞–∑</option>
                </select>
            </div>
            <button type="submit" class="btn" id="addPaymentBtn">–î–æ–¥–∞—Ç–∏ –æ–ø–ª–∞—Ç—É</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('addPaymentModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </form>
    </div>
</div>

<!-- Modal –ø–µ—Ä–µ–≥–ª—è–¥ –ø–ª–∞—Ç–µ–∂—ñ–≤ -->
<div id="viewPaymentsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('viewPaymentsModal')">&times;</span>
        <h2>–ü–µ—Ä–µ–≥–ª—è–¥ –æ–ø–ª–∞—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
        <div class="form-group">
            <label for="viewPaymentStudentId">–°—Ç—É–¥–µ–Ω—Ç:</label>
            <select id="viewPaymentStudentId" onchange="loadStudentPayments()">
                <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
            </select>
        </div>
        <div class="loading" id="paymentsLoading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        <div id="paymentsTableContainer"></div>
    </div>
</div>

<!-- Modal –ø–µ—Ä–µ–≥–ª—è–¥ –∑–∞—Å–µ–ª–µ–Ω–Ω—è -->
<div id="viewSettlementsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('viewSettlementsModal')">&times;</span>
        <h2>–°–ø–∏—Å–æ–∫ –ø–æ—Å–µ–ª–µ–Ω—å</h2>
        <div class="loading" id="settlementsLoading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        <div id="settlementsTableContainer"></div>
    </div>
</div>

<!-- Modal –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
<div id="deleteStudentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('deleteStudentModal')">&times;</span>
        <h2>–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
        <div class="form-group">
            <label for="deleteStudentId">–°—Ç—É–¥–µ–Ω—Ç –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è:</label>
            <select id="deleteStudentId" required>
                <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
            </select>
        </div>
        <div class="alert alert-error">
            <strong>–£–≤–∞–≥–∞!</strong> –¶–µ –¥—ñ—è –≤–∏–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ —Ç–∞ –≤—Å—ñ –ø–æ–≤'—è–∑–∞–Ω—ñ –¥–∞–Ω—ñ (–ø–æ—Å–µ–ª–µ–Ω–Ω—è, –æ–ø–ª–∞—Ç–∏) –Ω–∞–∑–∞–≤–∂–¥–∏.
        </div>
        <button type="button" class="btn btn-danger" id="deleteStudentBtn" onclick="deleteStudent()">–í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal('deleteStudentModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
</div>

<!-- Modal –≤–∏—Å–µ–ª–µ–Ω–Ω—è -->
<div id="evictStudentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('evictStudentModal')">&times;</span>
        <h2>–í–∏—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
        <div class="form-group">
            <label for="evictStudentId">–°—Ç—É–¥–µ–Ω—Ç –¥–ª—è –≤–∏—Å–µ–ª–µ–Ω–Ω—è:</label>
            <select id="evictStudentId" required>
                <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
            </select>
        </div>
        <div class="alert alert-error">
            <strong>–£–≤–∞–≥–∞!</strong> –¶–µ –¥—ñ—è –≤–∏–¥–∞–ª–∏—Ç—å –ø–æ—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑ –∫—ñ–º–Ω–∞—Ç–∏.
        </div>
        <button type="button" class="btn btn-danger" id="evictStudentBtn" onclick="evictStudent()">–í–∏—Å–µ–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal('evictStudentModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
</div>

<script>
    // API Base URL
    const API_BASE = 'http://localhost:3000/api';

    // –¥–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–ª–∏–∫—ñ–≤ API
    async function apiCall(endpoint, options = {}) {
        try {
            const response = await fetch(`${API_BASE}${endpoint}`, {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            }

            return await response.json();
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }

    // Modal —Ñ—É–Ω–∫—Ü—ñ—ó
    async function openModal(modalId) {
        document.getElementById(modalId).style.display = 'block';

        // Modal –∑–∞–ø–æ–≤–µ–Ω–Ω—è –≤–∏–ø–∞–¥–∞—é—á—ñ—Ö —Å–ø–∏—Å–∫—ñ–≤ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
        if (['settleStudentModal', 'addPaymentModal', 'viewPaymentsModal', 'deleteStudentModal', 'evictStudentModal'].includes(modalId)) {
            await populateStudentDropdowns();
        }

        // Modal –∑–∞–ø–æ–≤–µ–Ω–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω—ñ—Ö –∫—ñ–º–Ω–∞—Ç
        if (modalId === 'settleStudentModal') {
            await populateAvailableRooms();
        }
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    // –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
    async function populateStudentDropdowns() {
        try {
            const students = await apiCall('/students');
            const dropdowns = ['settleStudentId', 'paymentStudentId', 'viewPaymentStudentId', 'deleteStudentId', 'evictStudentId'];

            dropdowns.forEach(dropdownId => {
                const select = document.getElementById(dropdownId);
                if (select) {
                    select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</option>';
                    students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student.student_id;
                        option.textContent = `${student.student_id}. ${student.full_name}`;
                        select.appendChild(option);
                    });
                }
            });
        } catch (error) {
            showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤');
        }
    }

    // –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    async function updateStats() {
        try {
            const stats = await apiCall('/statistics');
            document.getElementById('totalStudents').textContent = stats.totalStudents;
            document.getElementById('totalSettlements').textContent = stats.totalSettlements;
            document.getElementById('totalPayments').textContent = stats.totalPayments;
        } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
        }
    }

    // —É—Å–ø—ñ—Ö(–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è) =)
    function showSuccess(message) {
        const alert = document.createElement('div');
        alert.className = 'alert alert-success';
        alert.innerHTML = `<strong>–£—Å–ø—ñ—Ö!</strong> ${message}`;
        alert.style.position = 'fixed';
        alert.style.top = '20px';
        alert.style.right = '20px';
        alert.style.zIndex = '9999';
        alert.style.maxWidth = '400px';
        document.body.appendChild(alert);

        setTimeout(() => {
            if (document.body.contains(alert)) {
                document.body.removeChild(alert);
            }
        }, 3000);
    }

    // –ø–æ–º–∏–ª–∫–∞(–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è) =(
    function showError(message) {
        const alert = document.createElement('div');
        alert.className = 'alert alert-error';
        alert.innerHTML = `<strong>–ü–æ–º–∏–ª–∫–∞!</strong> ${message}`;
        alert.style.position = 'fixed';
        alert.style.top = '20px';
        alert.style.right = '20px';
        alert.style.zIndex = '9999';
        alert.style.maxWidth = '400px';
        document.body.appendChild(alert);

        setTimeout(() => {
            if (document.body.contains(alert)) {
                document.body.removeChild(alert);
            }
        }, 5000);
    }

    // –æ–±—Ä–æ–±–Ω–∏–∫ —Ñ–æ—Ä–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
    document.getElementById('addStudentForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const btn = document.getElementById('addStudentBtn');
        btn.disabled = true;
        btn.textContent = '–î–æ–¥–∞–≤–∞–Ω–Ω—è...';

        try {
            const data = {
                name: document.getElementById('studentName').value,
                birthDate: document.getElementById('birthDate').value,
                gender: document.getElementById('gender').value,
                phone: document.getElementById('phone').value,
                group: document.getElementById('group').value,
                passport: document.getElementById('passport').value
            };

            const result = await apiCall('/students', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            showSuccess(result.message);
            closeModal('addStudentModal');
            this.reset();
            await updateStats();
        } catch (error) {
            showError(error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = '–î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞';
        }
    });

    // –ø–µ—Ä–µ–≥–ª—è–¥ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
    async function viewStudents() {
        const container = document.getElementById('studentsTableContainer');
        const loading = document.getElementById('studentsLoading');

        loading.style.display = 'block';
        container.innerHTML = '';

        try {
            const students = await apiCall('/students');

            if (students.length === 0) {
                container.innerHTML = '<div class="no-data">–°—Ç—É–¥–µ–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
            } else {
                let html = '<table class="data-table"><thead><tr><th>ID</th><th>–ü–Ü–ë</th><th>–ì—Ä—É–ø–∞</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ü–∞—Å–ø–æ—Ä—Ç</th></tr></thead><tbody>';

                students.forEach(student => {
                    html += `<tr>
                            <td>${student.student_id}</td>
                            <td>${student.full_name}</td>
                            <td>${student.university_group}</td>
                            <td>${student.phone}</td>
                            <td>${student.passport_number}</td>
                        </tr>`;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            }
        } catch (error) {
            container.innerHTML = '<div class="alert alert-error">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</div>';
            showError(error.message);
        } finally {
            loading.style.display = 'none';
        }

        openModal('viewStudentsModal');
    }

    // —Ñ—ñ–ª—å—Ç—Ä –ø–æ—à—É–∫—É –°–¢–£–î–ï–ù–¢
    function filterStudents() {
        const filter = document.getElementById('studentSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#studentsTableContainer table tbody tr');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    }

    // –æ–±—Ä–æ–±–∫–∞ –∑–∞—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
    document.getElementById('settleStudentForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const btn = document.getElementById('settleStudentBtn');
        btn.disabled = true;
        btn.textContent = '–ü–æ—Å–µ–ª–µ–Ω–Ω—è...';

        try {
            const data = {
                studentId: parseInt(document.getElementById('settleStudentId').value),
                roomNumber: document.getElementById('roomNumber').value, // Changed from roomId
                settleDate: document.getElementById('settleDate').value
            };

            const result = await apiCall('/settlements', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            showSuccess(result.message);
            closeModal('settleStudentModal');
            this.reset();
            await updateStats();
        } catch (error) {
            showError(error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = '–ü–æ—Å–µ–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞';
        }
    });

    // –æ–±—Ä–æ–±–∫–∞ –ø–ª–∞—Ç–µ–∂—ñ–≤
    document.getElementById('addPaymentForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const btn = document.getElementById('addPaymentBtn');
        btn.disabled = true;
        btn.textContent = '–î–æ–¥–∞–≤–∞–Ω–Ω—è...';

        try {
            const data = {
                studentId: parseInt(document.getElementById('paymentStudentId').value),
                paymentDate: document.getElementById('paymentDate').value,
                amount: parseFloat(document.getElementById('amount').value),
                paymentMethod: document.getElementById('paymentMethod').value
            };

            const result = await apiCall('/payments', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            showSuccess(result.message);
            closeModal('addPaymentModal');
            this.reset();
            await updateStats();
        } catch (error) {
            showError(error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = '–î–æ–¥–∞—Ç–∏ –æ–ø–ª–∞—Ç—É';
        }
    });

    // –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—ñ–≤
    async function loadStudentPayments() {
        const studentId = parseInt(document.getElementById('viewPaymentStudentId').value);
        const container = document.getElementById('paymentsTableContainer');
        const loading = document.getElementById('paymentsLoading');

        if (!studentId) {
            container.innerHTML = '';
            return;
        }

        loading.style.display = 'block';
        container.innerHTML = '';

        try {
            const payments = await apiCall(`/payments/student/${studentId}`);

            if (payments.length === 0) {
                container.innerHTML = '<div class="no-data">–û–ø–ª–∞—Ç–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
            } else {
                let html = '<table class="data-table"><thead><tr><th>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç–∏</th><th>–°—É–º–∞ (–≥—Ä–Ω)</th><th>–°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏</th></tr></thead><tbody>';

                payments.forEach(payment => {
                    const paymentMethodText = {
                        'cash': '–ì–æ—Ç—ñ–≤–∫–∞',
                        'card': '–ö–∞—Ä—Ç–∫–∞',
                        'bank_transfer': '–ë–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π –ø–µ—Ä–µ–∫–∞–∑'
                    };

                    html += `<tr>
                    <td>${new Date(payment.payment_date).toLocaleDateString('uk-UA')}</td>
                    <td>${parseFloat(payment.amount).toFixed(2)}</td>
                    <td>${paymentMethodText[payment.payment_method] || payment.payment_method}</td>
                </tr>`;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            }
        } catch (error) {
            container.innerHTML = '<div class="alert alert-error">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–ª–∞—Ç</div>';
            showError(error.message);
        } finally {
            loading.style.display = 'none';
        }
    }

    async function populateAvailableRooms() {
        try {
            const rooms = await apiCall('/rooms/available');
            const roomSelect = document.getElementById('roomNumber');

            if (roomSelect) {
                roomSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É</option>';
                rooms.forEach(room => {
                    const option = document.createElement('option');
                    option.value = room.room_number;
                    option.textContent = `–ö—ñ–º–Ω–∞—Ç–∞ ${room.room_number} (–≤—ñ–ª—å–Ω–æ: ${room.available_spots}/${room.capacity})`;
                    roomSelect.appendChild(option);
                });
            }
        } catch (error) {
            showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫—ñ–º–Ω–∞—Ç');
        }
    }

    async function viewSettlements() {
        const container = document.getElementById('settlementsTableContainer');
        const loading = document.getElementById('settlementsLoading');

        loading.style.display = 'block';
        container.innerHTML = '';

        try {
            const settlements = await apiCall('/settlements');

            if (settlements.length === 0) {
                container.innerHTML = '<div class="no-data">–ü–æ—Å–µ–ª–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
            } else {
                let html = '<table class="data-table"><thead><tr><th>ID —Å—Ç—É–¥–µ–Ω—Ç–∞</th><th>–ü–Ü–ë</th><th>–ù–æ–º–µ—Ä –∫—ñ–º–Ω–∞—Ç–∏</th><th>–î–∞—Ç–∞ –ø–æ—Å–µ–ª–µ–Ω–Ω—è</th></tr></thead><tbody>';

                settlements.forEach(settlement => {
                    html += `<tr>
                    <td>${settlement.student_id}</td>
                    <td>${settlement.full_name}</td>
                    <td>${settlement.room_number}</td>
                    <td>${new Date(settlement.settle_date).toLocaleDateString('uk-UA')}</td>
                </tr>`;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            }
        } catch (error) {
            container.innerHTML = '<div class="alert alert-error">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Å–µ–ª–µ–Ω—å</div>';
            showError(error.message);
        } finally {
            loading.style.display = 'none';
        }

        openModal('viewSettlementsModal');
    }

    // –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞
    async function deleteStudent() {
        const studentId = parseInt(document.getElementById('deleteStudentId').value);

        if (!studentId) {
            showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è');
            return;
        }

        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞? –¶–µ –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–∞!')) {
            return;
        }

        const btn = document.getElementById('deleteStudentBtn');
        btn.disabled = true;
        btn.textContent = '–í–∏–¥–∞–ª–µ–Ω–Ω—è...';

        try {
            const result = await apiCall(`/students/${studentId}`, {
                method: 'DELETE'
            });

            showSuccess(result.message);
            closeModal('deleteStudentModal');
            await updateStats();
            await populateStudentDropdowns(); // Refresh dropdowns
        } catch (error) {
            showError(error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = '–í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞';
        }
    }

    // –≤–∏—Å–µ–ª–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞
    async function evictStudent() {
        const studentId = parseInt(document.getElementById('evictStudentId').value);

        if (!studentId) {
            showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–ª—è –≤–∏—Å–µ–ª–µ–Ω–Ω—è');
            return;
        }

        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏—Å–µ–ª–∏—Ç–∏ —Ü—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑ –∫—ñ–º–Ω–∞—Ç–∏?')) {
            return;
        }

        const btn = document.getElementById('evictStudentBtn');
        btn.disabled = true;
        btn.textContent = '–í–∏—Å–µ–ª–µ–Ω–Ω—è...';

        try {
            const result = await apiCall(`/settlements/student/${studentId}`, {
                method: 'DELETE'
            });

            showSuccess(result.message);
            closeModal('evictStudentModal');
            await updateStats();
        } catch (error) {
            showError(error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = '–í–∏—Å–µ–ª–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞';
        }
    }

    // modal –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–Ω–∞ –ø–æ –∫–ª—ñ–∫—É(–∑–∑–æ–≤–Ω—ñ)
    window.onclick = function(event) {
        const modals = document.getElementsByClassName('modal');
        for (let modal of modals) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    }

    // modal –∑–∞–∫—Ä–∏—Ç—Ç—è –Ω–∞ esc
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const modals = document.getElementsByClassName('modal');
            for (let modal of modals) {
                if (modal.style.display === 'block') {
                    modal.style.display = 'none';
                }
            }
        }
    });

    // —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—è –¥–∞—Ç–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    function setDefaultDates() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('settleDate').value = today;
        document.getElementById('paymentDate').value = today;
    }

    // —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–∞–º–∏
    document.addEventListener('DOMContentLoaded', async function() {
        await updateStats();
        setDefaultDates();

        // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (30—Å)
        setInterval(updateStats, 30000);
    });

    // –≤–∞–ª—é—Ç–∞
    function formatCurrency(amount) {
        return new Intl.NumberFormat('uk-UA', {
            style: 'currency',
            currency: 'UAH',
            minimumFractionDigits: 2
        }).format(amount);
    }

    // –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
    function validatePhone(phone) {
        const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/;
        return phoneRegex.test(phone);
    }

    // –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–æ–º–µ—Ä—É –ø–∞—Å–ø–æ—Ä—Ç–∞
    function validatePassport(passport) {
        const passportRegex = /^[A-Z]{2}[0-9]{6}$/;
        return passportRegex.test(passport);
    }

    // –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–æ —Ñ–æ—Ä–º
    document.getElementById('addStudentForm').addEventListener('input', function(e) {
        const target = e.target;

        if (target.id === 'phone') {
            const isValid = validatePhone(target.value);
            target.style.borderColor = isValid ? '#28a745' : '#dc3545';

            if (!isValid && target.value.length > 0) {
                target.title = '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É';
            } else {
                target.title = '';
            }
        }

        if (target.id === 'passport') {
            const isValid = validatePassport(target.value.toUpperCase());
            target.style.borderColor = isValid ? '#28a745' : '#dc3545';
            target.value = target.value.toUpperCase();

            if (!isValid && target.value.length > 0) {
                target.title = '–§–æ—Ä–º–∞—Ç: AB123456 (2 –ª—ñ—Ç–µ—Ä–∏ + 6 —Ü–∏—Ñ—Ä)';
            } else {
                target.title = '';
            }
        }
    });

    /*
    function exportToCSV(data, filename) {
        const csvContent = "data:text/csv;charset=utf-8,"
            + data.map(row => Object.values(row).join(",")).join("\n");

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    */
    // –≤–∏–≤—ñ–¥
    function printTable(tableId) {
        const printWindow = window.open('', '', 'height=600,width=800');
        const table = document.getElementById(tableId);

        printWindow.document.write('<html><head><title>–î—Ä—É–∫</title>');
        printWindow.document.write('<style>table { border-collapse: collapse; width: 100%; } th, td { border: 1px solid #ddd; padding: 8px; text-align: left; } th { background-color: #f2f2f2; }</style>');
        printWindow.document.write('</head><body>');
        printWindow.document.write(table.outerHTML);
        printWindow.document.write('</body></html>');

        printWindow.document.close();
        printWindow.print();
    }

    // –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–æ—Ä–º
    function autoSaveFormData(formId) {
        const form = document.getElementById(formId);
        const inputs = form.querySelectorAll('input, select');

        inputs.forEach(input => {
            const savedValue = localStorage.getItem(`${formId}_${input.id}`);
            if (savedValue && input.type !== 'submit') {
                input.value = savedValue;
            }

            input.addEventListener('input', function() {
                if (input.type !== 'submit') {
                    localStorage.setItem(`${formId}_${input.id}`, input.value);
                }
            });
        });

        // –∞–≤—Ç–æ–≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω–∏—Ö —Ñ–æ—Ä–º –ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
        form.addEventListener('submit', function() {
            inputs.forEach(input => {
                localStorage.removeItem(`${formId}_${input.id}`);
            });
        });
    }

    // —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö —Ñ–æ—Ä–º
    document.addEventListener('DOMContentLoaded', function() {
        autoSaveFormData('addStudentForm');
        autoSaveFormData('settleStudentForm');
        autoSaveFormData('addPaymentForm');
    });

    // –ø–æ—à—É–∫ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ (debouncing)
    let searchTimeout;
    function debounceSearch(func, delay) {
        return function(...args) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => func.apply(this, args), delay);
        };
    }

    // debouncing
    const debouncedFilterStudents = debounceSearch(filterStudents, 300);

    // –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—à—É–∫—É event listener
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('studentSearch');
        if (searchInput) {
            searchInput.addEventListener('keyup', debouncedFilterStudents);
        }
    });

    // —Å—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (button)
    function setButtonLoading(buttonId, isLoading, originalText, loadingText) {
        const button = document.getElementById(buttonId);
        if (button) {
            button.disabled = isLoading;
            button.textContent = isLoading ? loadingText : originalText;
        }
    }

    // –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —ñ–∑ —Ñ—É–Ω–∫—Ü—ñ—î—é –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —Å–ø—Ä–æ–±–∏
    async function apiCall(endpoint, options = {}) {
        try {
            const response = await fetch(`${API_BASE}${endpoint}`, {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            });

            // –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
            if (!response.ok) {
                // JSON –ø–æ–º–∏–ª–∫–∞
                let errorMessage = '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
                try {
                    const errorData = await response.json();
                    errorMessage = errorData.error || errorMessage;
                } catch (parseError) {
                    // HTML –ø–æ–º–∏–ª–∫–∞
                    const htmlText = await response.text();
                    if (htmlText.includes('404') || response.status === 404) {
                        errorMessage = 'API endpoint –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä.';
                    } else if (response.status === 500) {
                        errorMessage = '–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
                    } else {
                        errorMessage = `–ü–æ–º–∏–ª–∫–∞ HTTP ${response.status}`;
                    }
                }
                throw new Error(errorMessage);
            }

            // –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ JSON
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                throw new Error('–°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö');
            }

            return await response.json();
        } catch (error) {
            console.error('API Error:', error);

            // –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑\'—î–¥–Ω–∞–Ω–Ω—è.');
            }

            throw error;
        }
    }

    // —ñ–Ω–¥—ñ–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É —Å–µ—Ä–≤–µ—Ä–∞
    function updateNetworkStatus() {
        const isOnline = navigator.onLine;
        const statusElement = document.getElementById('networkStatus');

        if (!statusElement) {
            const status = document.createElement('div');
            status.id = 'networkStatus';
            status.style.cssText = `
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 10000;
            transition: all 0.3s ease;
        `;
            document.body.appendChild(status);
        }

        const status = document.getElementById('networkStatus');
        if (isOnline) {
            status.textContent = 'üü¢ –û–Ω–ª–∞–π–Ω';
            status.style.backgroundColor = '#d4edda';
            status.style.color = '#155724';
        } else {
            status.textContent = 'üî¥ –û—Ñ–ª–∞–π–Ω';
            status.style.backgroundColor = '#f8d7da';
            status.style.color = '#721c24';
        }
    }

    // –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);

    // —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞—Ç—É—Å—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
    document.addEventListener('DOMContentLoaded', updateNetworkStatus);
</script>
</body>
</html>
